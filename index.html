<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>转盘抽奖</title>
    <style>
        .zhuanPan {
            width: 468px;
            height: 393px;
            background: url('./img/zhuabpan.gif') no-repeat;
            background-size: cover;
            padding: 30px;
        }
        table{
            width: 98%;
            height: 98%;
        }
        table tr{
            width: 100%;
        }
        table tr td{
            background: forestgreen;
            font-size: 30px;
            color: white;
            text-align: center;
        }
        td.cursor{
            background: gold;
            color: red;
            cursor: pointer;
        }
        .active{
            background: blue;
        }
    </style>
</head>

<body>
    <div class="zhuanPan">
        <table id="tab">
            <tr>
                <td class="draw draw0">
                    奖品一
                </td>
                <td class="draw draw1">
                    奖品二
                </td>
                <td class="draw draw2">
                    奖品三
                </td>
            </tr>
            <tr>
                <td class="draw draw7">
                    奖品八
                </td>
                <td class="cursor">
                    GO
                </td>
                <td class="draw draw3">
                    奖品四
                </td>
            </tr>
            <tr>
                <td class="draw draw6">
                    奖品七
                </td>
                <td class="draw draw5">
                    奖品六
                </td>
                <td class="draw draw4">
                    奖品五
                </td>
            </tr>
        </table>
    </div>
</body>

</html>
<script
  src="https://code.jquery.com/jquery-2.2.4.js"
  integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
  crossorigin="anonymous">
  </script>
<script>
    var giftGrade;//奖品
    var click;
    var tie;
    var lottery = {
        index : -1,//当前转动位置
        speed : 20,//转动速度
        counter : 0,//总共有多少位置
        timer : 0,//定时器
        times : 0,//转动次数
        cycle : 50,//转动基本次数
        price : -1,//中将位置
        init : function(tab){//初始化
            if($('#' + tab).find('.draw').length > 0){
                $lottery = $('#' + tab);
                $units = $lottery.find('.draw');
                this.obj = $lottery;
                this.counter = $units.length;
                $lottery.find('.draw' + this.index).addClass('active');
            }
        },
        roll : function(){//
            var index = this.index;
            var counter = this.counter;
            var lottery = this.obj;
            $(lottery).find('.draw' + index).removeClass('active');
            index += 1;
            if (index > counter - 1) {
                index = 0;
            };
            $(lottery).find('.draw' + index).addClass('active');
            this.index = index;
		    return false;
        },
        stop : function(index){
            this.price = index;
		    return false;
        }
    }
    lottery.init('tab')
    function init(){
        lottery.index = -1;
        lottery.speed = 20,
        lottery.counter = 0;
        lottery.timer = 0;
        lottery.times = 0;
        lottery.cycle = 40;
        lottery.price = -1;
    }
    function roll(){
        click = true;
        $('.cursor').html('doing')
        lottery.times += 1; //转动次数加
        lottery.roll(); //转动过程调用的是lottery的roll方法，这里是第一次调用初始化
        if (lottery.times > lottery.cycle + 10 && giftGrade == lottery.index) {
            clearTimeout(lottery.timer);
            lottery.price = -1;
            lottery.times = 0;
            lottery.speed = 20,
            click = false;
            $('.cursor').html('GO')
            if(tie){
                clearTimeout(tie)
            }
            tie = setTimeout(function(){
                alert($('#tab').find($('.draw' + giftGrade)).html())
            },500)
        } else {
            if (lottery.times < lottery.cycle) {
                lottery.speed -= 10;
            } else if (lottery.times == lottery.cycle) {
            } else {
                if (lottery.times > lottery.cycle + 10 && ((lottery.price == 0 && lottery.index == 7) || lottery.price == lottery.index + 1)) {
                    lottery.speed += 120;
                } else {
                    lottery.speed += 50;
                }
            }
            if (lottery.speed < 40) {
                lottery.speed = 40;
            };
		    lottery.timer = setTimeout(roll, lottery.speed); //循环调用
        }
        return false;
    }

    //抽奖
    $('.cursor').on('click',function(){
        if (click) { //click控制一次抽奖过程中不能重复点击抽奖按钮，后面的点击不响应
			return false
		} else {
            var mathRandom = Math.floor(Math.random()*8);
            giftGrade = mathRandom
            roll();
		}
    })
</script>